jQuery(document).ready(function(e){function a(a,n,t){let i=a,p=i.val(),c=i.data("post_type");setTimeout(function(){if(p!==i.val())return;l({action:"epkb_search_posts",search_value:p,search_post_type:c,search_page:t,_wpnonce_epkb_post_search:e("#_wpnonce_epkb_post_search").val()},o,a)},n)}function o(e,a){1==e.page?a.closest(".epkb_search_posts_form").find(".epkb_search_results").replaceWith(e.data):a.closest(".epkb_search_posts_form").find(".epkb_search_results").append(e.data)}function n(a){e("#epkb-help-dialog-create-location-form-container").show(),e("#epkb_create_location").hide(),e("#epkb_update_location").show(),e("#epkb-location-add").hide(),e("#epkb-location-id").val(a.location.id),e("#epkb-location-input").val(a.location.location),e("#epkb-answer-input").val(a.location.answer)}function t(a){e("#epkb-help-dialog-create-location-form-container").hide(),e("#epkb-location-input").val(""),e("#epkb-answer-input").val(""),e("#epkb-location-add").show();l({action:"epkb_update_location_list",_wpnonce_epkb_create_location:e("#_wpnonce_epkb_create_location").val()},i)}function i(a){e(".epkb-locations-list").html(),e(".epkb-locations-list").html(a.message)}function p(a){e("#epkb-add-faq-form").show(),e("#epkb_create_faq").hide(),e("#epkb_update_faq").show(),e("#epkb-faq-add").hide(),e("#epkb-faq-id").val(a.faq.id),e("#epkb-question-input").val(a.faq.question),e("#epkb-answer-input").val(a.faq.answer)}function c(a){e("#epkb-help-dialog-create-question-form-container").hide(),e("#epkb-question-input").val(""),e("#epkb-answer-input").val(""),e("#epkb-faq-add").show();l({action:"epkb_update_faq_list",_wpnonce_epkb_create_faq:e("#_wpnonce_epkb_create_faq").val()},_)}function _(a){e(".epkb-faqs-list").html(),e(".epkb-faqs-list").html(a.message)}function l(a,o,n,t){let i,p;o=void 0===o?"epkb_callback_noop":o,e.ajax({type:"POST",dataType:"json",data:a,url:ajaxurl,beforeSend:function(e){s("show","")}}).done(function(e){((p=e||"").error||void 0===p.message)&&(i=p.message?p.message:d("",epkb_vars.reload_try_again,"error"))}).fail(function(e,a,o){i=o?" ["+o+"]":epkb_vars.unknown_error,i=d(epkb_vars.error_occurred+". "+epkb_vars.msg_try_again,i,"error")}).always(function(){if(i)return s("remove",""),void e(".eckb-bottom-notice-message").html(i).removeClass("fadeOutDown");s("remove",""),"function"==typeof o?(p=void 0===p?"":p,"undefined"===n?o(p):o(p,n)):t&&location.reload()})}function s(a,o){if("show"===a){let a='<div class="epkb-admin-dialog-box-loading"><div class="epkb-admin-dbl__header"><div class="epkb-admin-dbl-icon epkbfa epkbfa-hourglass-half"></div>'+(o?'<div class="epkb-admin-text">'+o+"</div>":"")+'</div></div><div class="epkb-admin-dialog-box-overlay"></div>';e("body").append(a)}else"remove"===a&&(e(".epkb-admin-dialog-box-loading").remove(),e(".epkb-admin-dialog-box-overlay").remove())}function d(e,a,o){return'<div class="eckb-top-notice-message"><div class="contents"><span class="'+o+'">'+(e?"<h4>"+e+"</h4>":"")+(a||"")+"</span></div></div>"}e(document).click(function(){e(".epkb__live_search_res").removeClass("visible_search_res")}),e("body").on("click",".epkb__search_posts",function(){return!1}),e("body").on("input",".epkb__search_posts",function(){a(e(this),1e3,1)}),e("body").on("click",".epkb_search_results li",function(){let a=e(this);if(!a.hasClass("epkb__no_res")){let e=a.text(),o=a.data("post_id"),n=a.closest(".epkb_search_posts_form"),t=n.find(".epkb_selected_posts"),i=n.find('.epkb_search_input input[type="hidden"]'),p='<span data-post_id="'+o+'">'+e+'<span class="epkb__menu_remove epkbfa epkbfa-close"></span></span>';-1===t.html().indexOf('data-post_id="'+o+'"')&&(t.append(p),""===i.val()?i.val(o):i.val(function(e,a){return a+","+o}))}return!1}),e("body").on("mousewheel DOMMouseScroll",".epkb_search_results",function(){let o=void 0===e(this).data("page")?1:e(this).data("page"),n=void 0===e(this).data("scroll")?0:e(this).data("scroll");0==e(this).scrollTop()%200&&e(this).scrollTop()>n&&(e(this).data("page",o+1),e(this).data("scroll",e(this).scrollTop()),a(e(this).closest(".epkb_search_posts_form").find(".epkb__search_posts"),0,o+1))}),e("body").on("click",".epkb_selected_posts span.epkb__menu_remove",function(){let a=e(this).parent(),o=a.closest(".epkb_search_posts_form").find('.epkb_search_input input[type="hidden"]'),n=o.val(),t=a.data("post_id");if(-1!==n.indexOf(t)){let e=-1!==n.indexOf(","+t)?","+t:t+",";e=-1!==n.indexOf(",")?e:t;let a=n.replace(e,"");o.val(a)}return a.remove(),!1}),e(document.body).on("change","input[name=epkb_help_dialog_enable]",function(a){e(this).prop("checked")?e(this).val("on"):e(this).val("off");l({action:"epkb_enable_help_dialog",epkb_help_dialog_enable:e(this).val(),_wpnonce_epkb_enable_help_dialog:e("#_wpnonce_epkb_enable_help_dialog").val()},"","",!0)}),e(document.body).on("click","#epkb-location-add",function(a){a.preventDefault(),e("#epkb-help-dialog-create-location-form-container").show(),e("#epkb-location-add").hide(),e("#epkb_create_location").show(),e("#epkb_update_location").hide()}),e(document.body).on("click",".epkb_create_location_post",function(a){a.preventDefault();let o=e(document.body).find("#epkb-add-location-form");if(""==o.find(".epkb__search_posts").val())return;let n=o.find(".epkb_selected_posts").find("[data-post_id]").data("post_id");if(void 0==n)return;let i=[];o.find("#epkb-question-checkbox").find("input:checkbox[name^=epkb-question-checkbox]:checked").each(function(){i.push(e(this).val())});l({action:"epkb_create_location",location_type:"location-post",location_id:n,selected_questions:i,_wpnonce_epkb_create_location:e("#_wpnonce_epkb_create_location").val()},t)}),e(document.body).on("click",".epkb_create_location_cpt",function(a){a.preventDefault();l(e(this).serialize(),t)}),e(document.body).on("click",".epkb-location-edit",function(a){a.preventDefault();l({action:"epkb_get_location",location_id:e(this).parent().parent().parent().find(".epkb-location-id").val(),_wpnonce_epkb_create_location:e("#_wpnonce_epkb_create_location").val()},n)}),e(document.body).on("click","#epkb_update_location",function(a){a.preventDefault();l({action:"epkb_update_location",location_id:e(this).parent().parent().parent().find("#epkb-location-id").val(),location_input:e("#epkb-location-input").val(),answer_input:e("#epkb-answer-input").val(),_wpnonce_epkb_update_location:e("#_wpnonce_epkb_update_location").val()},t)}),e(document.body).on("click",".epkb-location-delete",function(a){a.preventDefault();l({action:"epkb_delete_location",location_id:e(this).parent().parent().parent().find(".epkb-location-id").val(),_wpnonce_epkb_submit_action:e("#_wpnonce_epkb_submit_action").val()},t)}),e(document.body).on("click","#epkb-faq-add",function(a){a.preventDefault(),e("#epkb-add-faq-form").show(),e("#epkb-faq-add").hide(),e("#epkb_create_faq").show(),e("#epkb_update_faq").hide()}),e(document.body).on("submit","#epkb-add-faq-form",function(a){a.preventDefault();l(e(this).serialize(),c)}),e(document.body).on("click",".epkb-faq-edit",function(a){a.preventDefault();l({action:"epkb_get_faq",faq_id:e(this).parent().parent().parent().data("record-id"),_wpnonce_epkb_faq:e(document.body).find("#_wpnonce_epkb_faq").val()},p)}),e(document.body).on("click","#epkb_update_faq",function(a){a.preventDefault();l({action:"epkb_update_faq",faq_id:e(this).parent().parent().find("#epkb-faq-id").val(),question_input:e("#epkb-question-input").val(),answer_input:e("#epkb-answer-input").val(),_wpnonce_epkb_faq:e(document.body).find("#_wpnonce_epkb_faq").val()},c)}),e(document.body).on("click",".epkb-faq-delete",function(a){a.preventDefault();l({action:"epkb_delete_faq",faq_id:e(this).parent().parent().parent().data("record-id"),_wpnonce_epkb_faq:e(document.body).find("#_wpnonce_epkb_faq").val()},c)})});